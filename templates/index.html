{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<form method="POST" enctype="multipart/form-data">
  <label for="ticker1">Enter Stock Ticker 1:</label>
  <input type="text" name="ticker1" id="ticker1" placeholder="AAPL" value="{{ request.form.ticker1 or '' }}">

  <label for="ticker2">Enter Ticker 2 (optional):</label>
  <input type="text" name="ticker2" id="ticker2" placeholder="MSFT" value="{{ request.form.ticker2 or '' }}">

  <p>Upload CSV (optional):</p>
  <input type="file" name="file1" accept=".csv">
  <label>{% if labels %}{{ labels[0] }}{% endif %}</label>

  <p>Upload second CSV (optional)</p>
  <input type="file" name="file2" accept=".csv">
  <label>{% if labels %}{{ labels[1] }}{% endif %}</label>

  <p>Select timeframe:</p>
  <div class="tabs" style="margin-top: 12px;">
  <button type="submit" name="time_range" value="1M" class="tab {% if time_range=='1M' %}active{% endif %}">1 Month</button>
  <button type="submit" name="time_range" value="3M" class="tab {% if time_range=='3M' %}active{% endif %}">3 Months</button>
  <button type="submit" name="time_range" value="6M" class="tab {% if time_range=='6M' %}active{% endif %}">6 Months</button>
  <button type="submit" name="time_range" value="1Y" class="tab {% if time_range=='1Y' or not time_range %}active{% endif %}">1 Year</button>
  <button type="submit" name="time_range" value="2Y" class="tab {% if time_range=='2Y' %}active{% endif %}">2 Years</button>
</div>

  <p>Select indicator:</p>
  <div class="tabs" style="margin-top: 12px;">
    <!-- each button is a submit that carries an 'indicator' value -->
    <button type="submit" name="indicator" value="" class="tab">Close Prices</button>
    <button type="submit" name="indicator" value="sma" class="tab">SMA</button>
    <button type="submit" name="indicator" value="ema" class="tab">EMA</button>
    <button type="submit" name="indicator" value="rsi" class="tab">RSI</button>
    <button type="submit" name="indicator" value="macd" class="tab">MACD</button>
  </div>

  {% if shown_indicator %}
    <div id="editable-params" style="margin-top:12px;">
      <h3>{{ shown_indicator|upper }} parameters</h3>

        {% if params %} 
          {% for key, value in params.items() %}
          <div class="param-field">
            <label for="{{ key }}">{{ key }}:</label>
            
            {# Determine input type based on value type #}
            {% if value is number %}
              <input type="number" id="{{shown_indicator}}_{{ key }}" name="{{shown_indicator}}_{{ key }}" value="{{ value }}" class="param-input">
            {% elif value is string %}
              <input type="text" id="{{shown_indicator}}_{{ key }}" name="{{shown_indicator}}_{{ key }}" value="{{ value }}" class="param-input">
            {% elif value is boolean %}
              <select id="{{shown_indicator}}_{{ key }}" name="{{shown_indicator}}_{{ key }}" class="param-select">
                <option value="true" {% if value %}selected{% endif %}>True</option>
                <option value="false" {% if not value %}selected{% endif %}>False</option>
              </select>
            {% else %}
              <input type="text" id="{{shown_indicator}}_{{ key }}" name="{{shown_indicator}}_{{ key }}" value="{{ value }}" class="param-input">
            {% endif %}
          </div>
          {% endfor %}

        {% else %}
          <p>No parameter metadata for this indicator â€” defaults will be used.</p>
        {% endif %}
    </div>
  {% endif %}

  <div style="margin-top:8px;">
    <button type="submit" name="apply" value="1">Update parameters</button>
  </div>

</form>      

{% if error %}
  <p style="color:red">{{ error }}</p>
{% endif %}

{# If a plot has been generated, render it directly below the options (no separate page) #}
{% if plot_div %}
  <div id="plot-area" style="margin-top:20px;">
    <h2>Analysis Results {% if shown_indicator %} - {{ shown_indicator|upper }}{% endif %}</h2>
    <ul>
      {% for label in labels %}
        <li>{{ label }}</li>
      {% endfor %}
    </ul>
    <div id="plot-container">
      {{ plot_div | safe }}
    </div>    
  </div>
{% endif %}
{% endblock %}

